# 数据检索增强生成(RAG)前端项目架构设计文档

## 1. 项目概述

本项目是一个基于React和Umi框架开发的数据检索增强生成(RAG)系统的前端应用。该系统主要用于构建和管理知识库、智能体以及提供基于大语言模型的对话功能。

## 2. 技术栈选择

### 前端框架
- **React 17.x**: 用于构建交互式用户界面的JavaScript库
- **UmiJS 3.x**: 企业级React应用框架，提供路由、状态管理等开箱即用的功能
- **TypeScript**: 提供静态类型检查，增强代码可维护性

### UI库
- **Ant Design**: 企业级UI组件库，提供丰富的预设组件
- **Ant Design Pro Layout**: 提供中后台布局组件
- **Tailwind CSS**: 功能类优先的CSS框架，提供灵活的样式定制能力

### 状态管理
- **Redux**: 通过UmiJS集成，用于全局状态管理
- **Redux Persist**: 状态持久化解决方案，保存用户会话等信息

### 网络请求
- **Fetch API**: 原生网络请求API
- **事件流**: 使用@microsoft/fetch-event-source实现流式响应(SSE)

## 3. 系统架构

### 前后端交互架构
```
+---------------------------+       +---------------------------+
|                           |       |                           |
|     前端应用(React/Umi)    |<----->|       后端API服务         |
|                           |       |                           |
+---------------------------+       +---------------------------+
          |                                      |
          |                                      |
          v                                      v
+---------------------------+       +---------------------------+
|                           |       |                           |
|     浏览器本地存储         |       |       数据库存储          |
|     (LocalStorage)        |       |    (知识库、用户数据等)    |
|                           |       |                           |
+---------------------------+       +---------------------------+
```

### 模块依赖关系
```
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|  登录模块   +---->+  用户管理   +---->+  权限控制   |
|             |     |             |     |             |
+-------------+     +-------------+     +------+------+
                                               |
                                               v
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|  知识库管理  |<--->+  智能体管理  |<--->+  聊天模块   |
|             |     |             |     |             |
+-------------+     +-------------+     +-------------+
```

## 4. 核心功能模块设计

### 4.1 登录模块
- **功能**: 用户认证、会话管理
- **后端依赖**: 需要后端服务提供身份验证API
- **关键组件**:
  - 登录表单
  - 密码重置流程
  - 登录状态持久化

### 4.2 用户管理模块
- **功能**: 用户账户管理、权限控制
- **后端依赖**: 需要后端服务提供用户CRUD和权限管理API
- **关键组件**:
  - 用户列表
  - 用户创建/编辑表单
  - 权限配置界面
  - 活动日志查询

### 4.3 知识库管理模块
- **功能**: 知识库创建、文档管理、文档解析、QA对管理
- **后端依赖**: 需要后端服务提供知识库管理API和文档处理API
- **关键组件**:
  - 知识库列表/创建/编辑界面
  - 文档上传和管理界面
  - 文档解析配置界面
  - QA对标注和管理界面

### 4.4 智能体管理模块
- **功能**: 智能体创建、配置、关联知识库、发布
- **后端依赖**: 需要后端服务提供智能体管理API
- **关键组件**:
  - 智能体列表/创建界面
  - 智能体配置界面
  - 知识库关联选择器
  - 发布流程界面

### 4.5 聊天模块
- **功能**: 对话界面、历史记录、知识引用、流式响应
- **后端依赖**: 需要后端服务提供聊天API和流式响应支持
- **关键组件**:
  - 聊天消息列表
  - 输入区域
  - 历史记录侧边栏
  - 知识引用详情弹窗
  - 流式输出处理

## 5. 数据流设计

### 5.1 用户认证数据流
1. 用户输入用户名和密码
2. 前端发送登录请求到后端
3. 后端验证并返回JWT令牌
4. 前端存储令牌并更新登录状态
5. 每次API请求都带上令牌

### 5.2 知识库数据流
1. 用户创建知识库基本信息
2. 上传文档到后端
3. 配置并触发文档解析
4. 后端进行解析并生成QA对
5. 用户可查看和编辑QA对

### 5.3 聊天数据流
1. 用户发送问题
2. 前端发送请求到后端
3. 后端检索相关知识并调用LLM生成回答
4. 使用SSE方式流式返回生成结果
5. 前端实时展示生成内容
6. 显示知识引用来源

## 6. 前后端接口依赖

所有功能模块都需要后端服务支持，主要接口包括：

### 用户相关
- 用户登录/注销
- 获取用户信息
- 用户列表查询
- 创建/编辑/删除用户
- 权限设置

### 知识库相关
- 知识库创建/编辑/删除
- 知识库列表查询
- 文档上传/删除
- 文档解析配置
- 文档解析执行
- QA对查询/编辑

### 智能体相关
- 智能体创建/编辑/删除
- 智能体列表查询
- 智能体配置设置
- 智能体发布/下线

### 聊天相关
- 聊天记录查询
- 发送消息
- 流式响应获取
- 知识来源查询

## 7. 安全性考虑

- 所有API请求都需要进行身份验证
- 用户权限控制应确保资源访问安全
- 应避免直接在前端存储敏感信息
- 聊天内容和知识库数据应进行必要的加密处理
- 防范XSS和CSRF攻击

## 8. 性能优化考虑

- 使用懒加载组件减少初始加载时间
- 列表数据采用分页加载
- 大文件上传采用分片上传
- 聊天历史记录采用虚拟滚动优化
- 流式响应确保实时显示大量文本
- 使用Redux持久化减少重复请求 